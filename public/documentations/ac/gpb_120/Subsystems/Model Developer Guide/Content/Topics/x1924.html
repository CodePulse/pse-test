<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="Model Developer Guide.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Custom Modelling in gPROMS|Conditional Equations">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>The Case conditional construct</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../Model Developer Guide.htm#Topics/x1924.html">Open topic with navigation</a>
        </p>
        <div>
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="5" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                </div>
            </div>
        </div>
        <div class="sect1">
            <h1 class="sect1"><a name="AEN1924"></a>The Case conditional construct</h1>
            <p>The gPROMS example below illustrates the use of the <code class="methodname">CASE</code> construct in a Model of a vessel with a bursting
 disc.</p>
            <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span><a name="AEN1928"></a>
                <p><b>Example 1. Model entity for a vessel equipped with a bursting disc</b>
                </p><pre class="programlisting"># MODEL VesselWithDisc

 PARAMETER
 R AS REAL DEFAULT 8.314 # J/K.mol
 VesselVolume AS REAL
 BurstPressure AS REAL
 AtmPressure AS REAL
 DiscConstant AS REAL

 VARIABLE
 FlowIn, FlowOut AS MolarFlowrate
 ReliefFlow AS MolarFlowrate
 HoldUp AS Moles
 T AS Temperature
 Pressure AS Pressure

 SELECTOR
 DiscFlag AS (Intact, Burst) DEFAULT Intact

 EQUATION

 # Mass balance
 $HoldUp = FlowIn - FlowOut - ReliefFlow ;

 # Ideal gas law
 Pressure * VesselVolume = Holdup * R * T ;

 CASE DiscFlag OF
 WHEN Intact : ReliefFlow = 0 ;
 SWITCH TO Burst IF Pressure &gt; BurstPressure ;
 WHEN Burst : ReliefFlow = DiscConstant * SQRT(R*T) ;
 END # Case

 # Energy balance
 . . . . . . . . . . . . . . . . . . . . . . </pre>
            </div>
            <p>We note that this Model presents two features of interest:</p>
            <div class="procedure">
                <ol type="1">
                    <li class="step" value="1">
                        <p>A <code class="methodname">SELECTOR</code> section is used for the declaration of the system states that arise from the discontinuity:
        </p><pre class="programlisting">SELECTOR
 DiscFlag AS (Intact, Burst) DEFAULT Intact</pre>declares an enumerated ("selector'') variable, <code class="methodname">DiscFlag</code> that
 can take only two values, namely <code class="methodname">Intact</code> or <code class="methodname">Burst</code>, with the former being the default value at
 the start of the simulation (see below). The default specification is optional and may be omitted.</li>
                    <li class="step" value="2">
                        <p>The Model equations include the <code class="methodname">CASE</code> equation:</p><pre class="programlisting">CASE DiscFlag OF
 WHEN Intact : ReliefFlow = 0 ;
 SWITCH TO Burst IF Pressure &gt; BurstPressure ;
 WHEN Burst : ReliefFlow = DiscConstant * SQRT(R*T) ;
 END # Case</pre>that defines<ul><li value="1"><p>the equation(s) that hold in each state, and</p></li><li value="2"><p>the logical condition(s) that trigger transitions between states.</p></li></ul></li>
                </ol>
            </div>
            <p>More precisely, the above <code class="methodname">CASE</code> construct states that:</p>
            <ul>
                <li value="1">
                    <p>When the system is in the <code class="methodname">Intact</code> state, the relief flow is zero. The system remains in this state as long as
 the pressure in the vessel is lower than the bursting pressure of the disc. When it exceeds that limit, a transition to the
        <code class="methodname">Burst</code> state is initiated.</p>
                </li>
                <li value="2">
                    <p>When the system is in the <code class="methodname">Burst</code> state, the relief flow is calculated from a sonic flow relationship. The form
 of the equation presented here is only for illustration purposes. A more detailed form would take account of various other effects, including
 the transition from sonic to sub-sonic flow as the pressure in the vessel decreases. As this is an irreversible discontinuity, there is no
 transition going back to the <code class="methodname">Intact</code> state.</p>
                </li>
            </ul>
            <div class="sect2">
                <h2 class="sect2"><a name="AEN1960"></a>Some general considerations when using the Case construct</h2>
                <p>In general, a Case equation comprises two or more clauses, one for each possible value of the corresponding Selector variable. Each of the
 clauses comprises a list of equations, followed by an optional list of Switch statements that define transitions from the current clause to
 other clauses of the Case equation. The list of equations may include any combination of simple, array and even conditional equations -
 including not only Case constructs but also If constructs. The latter feature allows nesting of conditional equations to arbitrary depth. It is
 important, however, to observe the following restrictions:</p>
                <ul>
                    <li value="1">
                        <p>The number of equations in each clause of a Case construct must be the same.</p>
                    </li>
                    <li value="2">
                        <p>Each Selector variable may be used in <i class="emphasis">only one</i> Case construct.</p>
                    </li>
                </ul>
                <p>The reason for the first restriction is obvious if one considers that the number of variables in the Model remains unaffected by the
 occurrence of transitions. Consequently, any change in the number of equations would lead to an over- or under-specified problem. The second
 restriction is imposed to avoid inconsistencies that might arise from different Case attempting to force the same Selector variable to switch to
 different values at the same time.</p>
            </div>
            <div class="sect2">
                <h2 class="sect2"><a name="mdg_initialselector"></a>Initial values of Selector variables</h2>
                <p>Another important consideration concerning the use of Case equations is that, in order for a simulation experiment to commence, the
 initial (i.e. at time <i class="emphasis">t=0</i>) value of the corresponding Selector variable has to be specified. Thus, in our example the user
 must specify whether or not the disc is initially intact or not. This information cannot be inferred automatically by gPROMS: the mere fact that
 the initial system pressure is below the bursting value does not necessarily mean that the disc is intact - it may well have burst as a result
 of earlier operation! If a default value has been specified for the Selector variable in the Model, then this will be used as its initial value
 for the simulation. More generally, this value can be set or overridden for individual simulation experiments. This is done in the
      <code class="methodname">INITIALSELECTOR</code> section of the Process (or Model). For instance:</p><pre class="programlisting">UNIT T101 AS VesselWithDisc
 ...
 INITIALSELECTOR
 T101.DiscFlag := T101.Burst ; # Disc is initially burst
 INITIAL
 T101.Pressure - T101.BurstPressure = -1E5 ; 
 ...</pre>
                <p>Thus, in this example, we specify the disc as being burst despite the fact that the initial pressure of the system is specified to be 1
 bar below the bursting pressure. From the syntactical point of view, it is important to note the use of the full pathname
      <code class="methodname">T101.Burst</code> to denote the value of the <code class="methodname">SELECTOR</code> variable. A specification of the form:</p><pre class="programlisting">UNIT T101 AS VesselWithDisc
 ...
 SELECTOR
 T101.DiscFlag := Burst ; # Disc is initially burst</pre>
                <p>would be meaningless as the identifier <code class="methodname">Burst</code> is not known directly to the Process section - it is defined only
 within the context of <code class="methodname">MODEL VesselWithDisc</code> of which <code class="methodname">T101</code> is an instance.</p>
            </div>
        </div>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">Â© 2017 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>