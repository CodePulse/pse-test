<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="Model Developer Guide.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Custom Modelling in gPROMS|Composite Models">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Variable pathnames and WITHIN</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../Model Developer Guide.htm#Topics/x2924.html">Open topic with navigation</a>
        </p>
        <div>
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="5" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                </div>
            </div>
        </div>
        <h1><a name="AEN2924"></a>Variable pathnames and WITHIN</h1>
        <p>As the number of intermediate hierarchical levels increases, so does the length of the pathnames required to reference Parameters and
 Variables at or close to the bottom of the hierarchy. Pathnames of the form:</p><pre class="programlisting">SeparationSection.Column(2).TopSection.Stage(1).T </pre>are
 quite common when dealing with complex processes.<p><i class="emphasis">It is recommended that you use pathname
 completion to help construct full and valid pathnames correctly; this is available within all entities in gPROMS</i>. Semantic
 errors, such as referencing a quantity in a lower-level Model that doesn't exist, are only detected when a Model based activity is
 executed.</p><p>Nevertheless, writing equations with long pathnames can become tedious and make code difficult to read, especially if a large part of the
 pathname is common to many of the Parameters or Variables referenced by an equation. The WITHIN construct helps relieve some of this
 burden.</p><p>A WITHIN construct encloses a list of equations and defines a <i class="emphasis">prefix</i> to be used for all Parameters and Variables
 referenced by the enclosed equations. Suppose, for instance, that Model Tray has a Variable Q that determines the heat loss from the tray to the
 environment. However, it contains no equation that actually determines this heat loss. Consider now using this tray Model within the top and
 bottom sections of a column. We wish to specify a simple heat transfer equation for determining the heat loss in the top section; however, the
 bottom section is well insulated. One way we can achieve this is as follows:</p><pre class="programlisting">MODEL DistillationColumn 

PARAMETER 
 TAmbient AS REAL 
 UA AS REAL 
 NoTrays AS INTEGER 

UNIT 
 TopSection, BottomSection AS LinkedTrays 

EQUATION 
 WITHIN TopSection DO 
 FOR k := 1 TO NoTrays DO 
 WITHIN Stage(k) DO 
 Q = UA * (T - TAmbient) ; 
 END # Within Stage(k) 
 END # For k 
 END # Within TopSection 

 WITHIN BottomSection DO 
 FOR k := 1 TO NoTrays DO 
 WITHIN Stage(k) DO 
 Q = 0 ; 
 END # Within Stage (k) 
 END # For k 
 END # Within BottomSection 
</pre>In trying to interpret the equation:<pre class="programlisting">Q = UA * (T - TAmbient) ; </pre>gPROMS will need to identify
 (<i class="emphasis">resolve</i>) the symbols <code class="varname">Q</code>, <code class="varname">UA</code>, <code class="varname">T</code> and <code class="varname">TAmbient</code>. It
 starts doing this by searching the Model corresponding to the UNIT mentioned in the innermost WITHIN statement. In this case, this is Model Tray
 which does, indeed, contain Variables <code class="varname">Q</code> and <code class="varname">T</code>. However, symbols <code class="varname">UA</code> and
    <code class="varname">TAmbient</code> still remain unresolved. Therefore, gPROMS considers the next enclosing WITHIN statement; this indicates that it
 should search Model LinkedTrays (of which TopSection is an instance). However, this Model does not contain the missing identifiers. So gPROMS now
 has to consider Model DistillationColumn itself – which does indeed allow it to resolve <code class="varname">UA</code> and
    <code class="varname">TAmbient</code>.<p>It is interesting to note that both the <code class="varname">DistillationColumn</code> and the <code class="varname">LinkedTrays</code> Models contain the
 Parameter <code class="varname">NoTrays</code>. However, this does not result in any ambiguity in resolving this Parameter when it appears in each of the
 two FOR constructs: gPROMS always tries to resolve symbols by searching the innermost WITHIN first. Thus, <code class="varname">NoTrays</code>
    in:</p><pre class="programlisting">WITHIN TopSection DO 
 FOR k := 1 TO NoTrays DO 
 ... 
 END 
END # within TopSection </pre>clearly refers to <code class="varname">TopSection.NoTrays</code> and <i class="emphasis">not</i> to Parameter
    <code class="varname">NoTrays</code> in <code class="varname">DistillationColumn</code>.
    <div><p class="Footer">&#160;</p><p class="Footer">&#160;</p><hr width="100%" size="0" align="center" /><p class="Footer">Commercial in confidence</p><p class="Footer">© 2017 Process Systems Enterprise Limited</p></div></body>
</html>