<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="Help.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Degrees of freedom problems</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../Help.htm#Topics/Workflow Guides/Troubleshooting/Degrees of freedom problems.htm">Open topic with navigation</a>
        </p>
        <div>
        </div>
        <h1>Degrees of freedom problems</h1>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Degrees of freedom analysis</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>When a flowsheet model is simulated, the gPROMS&#160;numerical solver attempts to find a solution to all mathematical equations contained in that flowsheet model. These equations involve both the fixed (or assigned) and free (calculated) variables. In order to find a unique solution (or find a solution from a limited number of possible solutions) the number of equations must equal the number of free variables. At the start of the simulation, a check is performed to determine whether this is true or not. If it is not true then an error message is displayed. The check, to determine if the equations are well-posed, can be identified in the execution output window. </p>
                <p>For correctly constructed flowsheets, the number of 'Model equations' will equal the number of 'Unknown variables' and the following message will be shown at the end of the 'well-posedness' check:</p>
                <div class="programlisting"><pre xml:space="preserve" class="executionOutput">
Structural analysis report

Variables:                  1073
    Unknown:                 688
        Algebraic:           688
        Differential:          0
    Known (assigned):        385

Equations:                   688
    Model equations:         688
    Initial conditions:        0

Index of the problem:          0<span style="color: #ff0000;">
Original problem is well posed</span></pre>
                    <p class="programlistingCaption">An example of the execution output for a well-posed system of equations. </p>
                </div>
                <p>When the system is not well-posed, an error message will be displayed before the well-posedness check to indicate that the system is not well-posed. The number of "Model equations" will not match the number of "Unknown variables":</p>
                <div class="programlisting"><pre xml:space="preserve" class="executionOutput">Constructing the system...

Performing Structural Analysis...
<span style="color: #ff0000;">ERROR: The system is not well posed.</span>


Structural analysis report

Variables:                   191
    Unknown:                 140
        Algebraic:           140
        Differential:          0
    Known (assigned):         51

Equations:                   139
    Model equations:         139
    Initial conditions:        0</pre>
                    <p class="programlistingCaption">An example of the execution output for a system of equations that is not well-posed.</p>
                </div>
                <p>For steady-state flowsheet models, the following types of problems can be distinguished:</p>
                <ul>
                    <li value="1">Underspecified: There are fewer model equations than unknown variables in the model.</li>
                    <li value="2">Overspecified: There are more model equations than unknown variables in the model.</li>
                    <li value="3">Both under and overspecified: Occurs when a part of the model is underspecified while another part is overspecified. This means that part of the equations in the model involve too few unknown variables while the other part of the equations involve too many unknown variables. It may even be that even though the model is not well-posed, the number of equations equals the number of unknown variables for the complete model.</li>
                </ul>
                <p>In <span class="ProductName">gPROMS ProcessBuilder</span> these types of errors can arise in different ways. Commonly the following mistakes are made during the construction of the flowsheet:</p>
                <ul>
                    <li value="1">The wrong number of values has been specified for an array input field that requires a certain number of values.</li>
                    <li value="2">An adjust, calc or controller model has been used to trade off specifications between unit models. However, in the unit model dialog the checkbox of the field that specifies the value of the variable as a fixed value has not been unchecked.</li>
                    <li value="3">An adjust, calc or controller model has been removed from the flowsheet. However, in the unit model dialog corresponding to the unit that it was connected to, the checkbox of the field that specified the value of variable has not been re-checked.</li>
                    <li value="4">The size of an array of input fields in a dialog has changed after a certain number of values have been provided for elements in that array. The number of values is not updated to reflect the new size.</li>
                    <li value="5">A port of a model has been left unconnected.</li>
                    <li value="6">A connection has been made between two units that is illegal but is not flagged up on the problem panel.</li>
                    <li value="7">In pressure-driven models a flow or pressure specification has been made inconsistently or a flow-pressure relationship has not been defined.</li>
                    <li value="8">An error has been made in writing custom unit models or writing custom plug-in models in the gPROMS&#160;language.</li>
                </ul>
            </div>
        </div>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Troubleshooting overspecified systems</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>For an overspecified system, an error message will indicate one or more equations together with a list of unknown variables in those equation. The number of unknown variables is smaller than the number of equations. In addition a list will be presented of fixed (or "assigned")&#160;variables in these equations. For a single equation with no unknown variables the message might look as follows:</p>
                <div class="programlisting"><pre xml:space="preserve" class="executionOutput">Original problem is not well posed.
The following 1 equation(s) involve only 0 unknown variable(s).
Model equations:
 [1]  CASE Flowsheet.adj_spec001.INIT.mode OF
    WHEN init_mode :
      *** ACTIVE ***
      Flowsheet.adj_spec001.INIT.adjust_value = Flowsheet.adj_spec001.INIT.adjust_init;
    WHEN normal_mode :
      Flowsheet.adj_spec001.INIT.source_value = Flowsheet.adj_spec001.INIT.target_value;
  END

The equation(s) shown above already consider the elimination of identities.
Set IdentityElimination := OFF to obtain structural diagnostics on the original set of equations.

Un-ASSIGNing one of the following variables will fix this structural problem:
 Flowsheet.adj_spec001.INIT.adjust_init
 Flowsheet.methanol003.SP_F_w.mass_flowrate</pre>
                    <p class="programlistingCaption">Overspecified system where a single equation contains no unknown variables</p>
                </div>
                <p>If the number of equations, that are part of the overspecified part of the system, is limited to one then problem is usually simple to solve. This generally arises from the following:</p>
                <ul>
                    <li value="1">An adjust, calc or controller model has been used to trade-off variables between unit models. However, in the unit model dialog that the adjusters is connected to, the checkbox of the field that specifies the value of the variable has not been unchecked.</li>
                    <li value="2">An adjust, calc or controller model has been used to trade-off variables that do not affect each other.</li>
                </ul>
                <p>Typically these errors occur when connecting a unit, which imposes an external specification on a unit model using a gMLBus port. For example connecting an "Adj_spec" model, and then forgetting to uncheck the associated field in the dialog of the unit model.</p>
                <p>If the number of equations and variables, listed in the error message, is limited (&lt;5) then it is often straightforward to determine where, in the flowsheet, the problem exists. From the equations and variables identify the unit model(s) to which they belong. Check those units for problems with connected adjust models.</p>
                <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span>
                    <p>An adjust unit "Adj1" has been used to trade-off a specification for the mass flowrate of Source "s1". The "Mass flowrate" field in the dialog has not been unchecked and a fixed value of 1 has been specified. Because the value is fixed, it can not be adjusted using the "adj1" model to achieve a desired target specification. </p>
                    <p>To correct this, examine the error message and note that the equations and variables in the message relate to the unit "adj1" and source "s1". Correct the error by unchecking the "Mass flowrate" field in the dialog of unit "s1".</p><pre xml:space="preserve" class="executionOutput">Original problem is not well posed.
The following 1 equation(s) involve only 0 unknown variable(s).
Model equations:
 [1]  CASE Flowsheet.adj1.INIT.mode OF
    WHEN init_mode :
      *** ACTIVE ***
      Flowsheet.adj1.INIT.adjust_value = Flowsheet.adj1.INIT.adjust_init;
    WHEN normal_mode :
      Flowsheet.adj1.INIT.source_value = Flowsheet.adj1.INIT.target_value;
  END

The equation(s) shown above already consider the elimination of identities.
Set IdentityElimination := OFF to obtain structural diagnostics on the original set of equations.

Un-ASSIGNing one of the following variables will fix this structural problem:
 Flowsheet.adj1.INIT.adjust_init
 Flowsheet.s1.SP_F_w.mass_flowrate</pre>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/adjust_overspecified.png" alt="" title="" />
                        </p>
                        <p class="FigureCaption">Adjust model "adj1" is used to adjust the mass flowrate of source "s1"</p>
                    </div>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/adjust_overspecified_dialog.png" alt="" title="" />
                        </p>
                        <p class="FigureCaption">"Mass flowrate" field has not been unchecked</p>
                    </div>
                    <p>&#160;</p>
                </div>
            </div>
        </div>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Troubleshooting underspecified systems</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>When part of the system has more unknown variables than equations, a message of the following type is shown together with a list of variables:</p><pre xml:space="preserve" class="executionOutput">You need to ASSIGN 1 variable.
List of algebraic variables:</pre>
                <p>Common mistakes, made during the construction of the flowsheet and the configuration of unit models:</p>
                <ul>
                    <li value="1">
                        <p>In a unit specification dialog a checkbox, next to a field, was unchecked. However, no adjust, calc or controller model was added and connected to that unit.</p>
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/troubleshooting_unchecked_filed.png" />
                        </p>
                    </li>
                    <li value="2">An adjust, calc or controller model has been removed from the flowsheet. However, in the unit operation dialog, corresponding to the unit that it was connected to, the checkbox of the field that specified the value of variable has not been re-checked.</li>
                    <li value="3"> In a specification dialog of a certain unit a checkbox, next to a field, was unchecked. An adjust, calc or controller model was properly connected. However, in the dialog of the adjust model, a variable was selected that was different from the field that was unchecked.</li>
                    <li value="4">An outlet "Port" was left unconnected for a model in "Pressure-driven" mode. "Pressure-driven" model requires sinks to be connected on outlet ports to define downstream pressures.</li>
                    <li value="5">In pressure-driven models, a flow or pressure specification has been made that is inconsistent.</li>
                    <li value="6">An error has been made, in the gPROMS&#160;language, when writing custom unit models or writing custom plug-in models. </li>
                </ul>
                <p>If the list of variables, displayed together with the message, is short (&lt;20) its usually straightforward to determine the cause of the problem. From the list of variables, identify the unit model(s) to which they belong. Check those units for problems listed above.</p>
                <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span>
                    <p>The "Mass flowrate" specification in source "s1" has been unchecked as it is to be traded-off against another quantity in the flowsheet. However, an adjust unit has not been connnected and an attempt to run the flowsheet was made. The error shown includes a list of variables, which below to three different unit operation models ("mix1","s1" and "sink1"). In this example the problem can be corrected by connecting an adjust model to "s1" and selecting the "Mass flowrate" on the "Adjust signal variables" tab.</p><pre xml:space="preserve" class="executionOutput">You need to ASSIGN 1 variable.
List of algebraic variables:
 Flowsheet.mix1.inlet(1).F
 Flowsheet.mix1.ms.EB.F_out(1)
 Flowsheet.mix1.ms.EB.w_out(1,"WATER")
 Flowsheet.mix1.ms.EB.h_out(1)
 Flowsheet.mix1.ms.EB.T
 Flowsheet.s1.REP(1).Component_molar_flowrate("WATER")
 Flowsheet.s1.REP(1).Component_mass_flowrate("WATER")
 Flowsheet.s1.REP(1).Molar_flowrate
 Flowsheet.sink1.REP(1).Component_molar_flowrate("WATER")
 Flowsheet.sink1.REP(1).Component_mass_flowrate("WATER")
 Flowsheet.sink1.REP(1).Molar_fraction("WATER")
 Flowsheet.sink1.REP(1).Molar_flowrate
 Flowsheet.sink1.REP(1).Average_molecular_weight
 Flowsheet.sink1.REP(1).Average_molecular_weight_reversible_flow(1)
 Flowsheet.sink1.REP(1).Molar_specific_enthalpy
 Flowsheet.sink1.REP(1).Stream_molar_fraction_reversible_flow(1,"WATER")</pre>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/adjust_underspecificied.png" />
                        </p>
                        <p class="FigureCaption">Adjust model "adj1" is used to adjust the mass flowrate of source "s1"</p>
                    </div>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/adjust_undespecified_dialog.png" />
                        </p>
                        <p class="FigureCaption">"Mass flowrate" field has been unchecked</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Troubleshooting approach for under and overspecification problems on complex flowsheets</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>If specification errors are made on more complex flowsheets, error messages related to under and overspecification problems might be accompanied by large lists of variables and equations. This can make it difficult to isolate the problem(s) and determine which unit models have been configured incorrectly. A strategy to solve these types of problems is to temporarily modify the flowsheet so that:</p>
                <ul>
                    <li value="1"> connections between units are removed and replaced by sources and sinks;</li>
                    <li value="2">parts of the flowsheet are removed.<br /></li>
                </ul>
                <p>For these modified flowsheets, the list of variables shown might be shorter. This makes it easier to determine which unit operation models are incorrectly configured by a process of elimination.</p>
                <div class="tip" data-mc-autonum="&lt;b&gt;Hint&lt;/b&gt;"><span class="autonumber"><span><b>Hint</b></span></span>
                    <p>For steady-state flowsheets, it may be useful to check whether recycle breakers have been placed in appropriate positions. While placing recycle breakers in itself will not directly remedy over and underspecification problems, correct placement will shorten the lists of variables which are shown together with the error message. Refer to <a href="Solving the unit models.htm" class="MCXref xref" xrefformat="'{paratext}'">'Solving the unit models'</a> for more information on verifying that recycle breakers have been placed correctly.</p>
                </div>
            </div>
        </div>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">© 2017 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>