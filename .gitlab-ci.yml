variables:
  DEPLOY_TEST_PATH: gitlabrunner@devcms:/var/www/virtual/website
  DEPLOY_LIVE_PATH: gitlab-slave@cms.psenterprise.com:/var/www/virtual/website

deploy_test:
  stage: deploy
  variables:
    GIT_STRATEGY: fetch
  environment:
    name: test
    url: https://www-local-2.psenterprise.com/
  only:
    - develop
  script:
    - rsync -a --whole-file --no-group --no-times --no-perms -e "ssh -T -o Compression=no -x" --exclude '.git' $CI_PROJECT_DIR'/' $DEPLOY_TEST_PATH --delete
    - ssh gitlabrunner@devcms "cd /var/www/virtual/website/sites/default && ln -s /var/www/drupal/sites_default_files files"
    - ssh gitlabrunner@devcms "cd /var/www/virtual/website && ln -s /var/www/drupal/sites_default_files public"

deploy_live:
  stage: deploy
  variables:
    GIT_STRATEGY: fetch
  environment:
    name: live
    url: https://www.psenterprise.com/
  only:
    - tags
  script:
    - rsync -a --whole-file --no-group --no-times --no-perms -e "ssh -p 2202 -T -o Compression=no -x" --exclude '.git' $CI_PROJECT_DIR'/' $DEPLOY_LIVE_PATH --delete

