<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="Model Developer Guide.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="Custom Modelling in gPROMS|Composite Models">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Expressions involving arrays of Units</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../Resources/TableStyles/GeneralTable.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../Model Developer Guide.htm#Topics/x2957.html">Open topic with navigation</a>
        </p>
        <div>
            <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="Custom Modelling.htm">Custom Modelling in gPROMS</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="c2799.html">Composite Models</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">Expressions involving arrays of Units</span>
            </div>
        </div>
        <h1><a name="MDG_UnitArrayExpressions"></a>Expressions involving arrays of Units</h1>
        <p>Occasionally, it will be necessary to write expressions involving of arrays of units and/or slices of arrays of units (i.e. a subset of the
 elements of an array – see <a href="x1323.html">Referring to array elements</a>). The rules governing expressions involving arrays of
 units are similar to those governing array expressions involving only Variables. However, there are some additional complications with arrays of
 units, so one should be familiar with the <a href="x1359.html">General rules for array expressions</a> and <a href="x1480.html">Using arrays in equations</a> before continuing.</p>
        <p>There are two situations to consider when writing expressions of arrays of units. The simplest case is when slices are specified for all
 dimensions of all arrays; the other is when at least one dimension of an array is unspecified (e.g. <code class="varname">A(2:3,)</code>).</p>
        <p>In the examples to come, the following conventions are used.</p>
        <ul>
            <li value="1">
                <p>Variable names always begin with the letter V; all other entities are Units.</p>
            </li>
            <li value="2">
                <p>Whole arrays are always indicated using parentheses and their dimensionality is indicated using commas to delimit the indices. For
 example, a two-dimensional array will be written as <code class="varname">V(,)</code> rather than <code class="varname">V()</code> or <code class="varname">V</code>, which
 are equally valid in gPROMS but could be confused with a one-dimensional array and a scalar respectively.</p>
            </li>
        </ul>
        <p>The first, and simplest, case to consider is when all dimensions of all arrays are specified (either by giving a specific element or a slice
 of elements). The expression below is an example of such an expression.</p><pre class="programlisting">UA(1:2).UB.P(1:3).V1 + UC.UD(1:2).P(1:3).V2 = 3 ;</pre>
        <p>This case is quite simple. It is clear that this expression should be expanded to give:</p><pre class="programlisting">UA(1).UB.P(1).V1 + UC.UD(1).P(1).V2 = 3 ;
UA(1).UB.P(2).V1 + UC.UD(1).P(2).V2 = 3 ;
UA(1).UB.P(3).V1 + UC.UD(1).P(3).V2 = 3 ;

UA(1).UB.P(1).V1 + UC.UD(1).P(1).V2 = 3 ;
UA(2).UB.P(2).V1 + UC.UD(2).P(2).V2 = 3 ;
UA(2).UB.P(3).V1 + UC.UD(2).P(3).V2 = 3 ;</pre>
        <p>The rules governing expressions like these are the same as those for ordinary arrays. Each of the terms on the left-hand side of the
 expression can be thought of as 2x3 arrays. The presence and location of any scalar elements do not affect this behaviour: <code class="varname">UB</code>
    and <code class="varname">UC</code> are in different places in the paths but neither their location nor their existence changes the dimensionality of the
 two terms. So the whole expression can be considered dimensionally equivalent to:</p><pre class="programlisting">VA(1:2,1:3) + VB(1:2,1:3) = 3 ;</pre>
        <p>and this is a legal array expression, because <code class="varname">VA</code> and <code class="varname">VB</code> have exactly the same dimensions.</p>
        <p>Even the dimensionality of the variables is unimportant to the validity of expressions of this type. The next example demonstrates
 this.</p><pre class="programlisting">UA(3:3,1:2).UB.P(1:4).V1 + UC.P(1,5:6).V2(1:4) = 3</pre>
        <p>Now the dimensions of <code class="varname">UA</code> and <code class="varname">UC.P</code> are identical (1x2) and the dimensions of <code class="varname">UB.P</code>
    are identical to <code class="varname">UC.P.V2</code>, so each term is equivalent to a 1x2x4 array and the expression is equivalent to:</p><pre class="programlisting">VA(3:3,1:2,1:4) + VB(1,5:6,1:4) = 3</pre>
        <p>So when all indices of all arrays are specified completely, the rules are identical to ordinary arrays: each term must be a scalar or of the
 same dimensionality.</p>
        <p>When it is necessary to refer to whole arrays, the situation becomes a little more complicated. Consider the first example again, but now
 writing the expression for the whole range of array elements:</p><pre class="programlisting">UA().UB.P().V1 + UC.UD().P().V2 = 3 ;</pre>
        <p>At first glance, this might look the same. Certainly, the number of elements in <code class="varname">UA()</code> must be the same as the number of
 elements in <code class="varname">UC.UD()</code>. However, the dimensionality of <code class="varname">P()</code> is harder to define in a simple way: the problem is
 that <code class="varname">P()</code> may have different number of elements for each element of <code class="varname">UA().UB</code> or <code class="varname">UC.UD()</code>. A
 more relevant example of this is given below.</p><pre class="programlisting">COLUMN_A(,).TRAY().V = COLUMN_B(,).TRAY().V ;</pre>
        <p>Here, we have two 2-dimensional arrays of distillation-column units, perhaps forming a separation network. There is no guarantee that each
 column will have the same number of trays: in fact it is extremely unlikely. So it is not possible to consider this expression, or the one before,
 as a simple array expression. What must be done instead is to consider the dimensions in each term of the expression more carefully.</p>
        <p>First, it is clear that <code class="varname">COLUMN_A(,)</code> and <code class="varname">COLUMN_B(,)</code> must have the same dimensionality. Next, for each
 element of <code class="varname">COLUMN_A(,)</code> and <code class="varname">COLUMN_B(,)</code>, the number of trays must also be equal, so that the following
 condition is met:</p><a name="AEN3010"></a>
        <blockquote class="BLOCKQUOTE">
            <p>The dimensionality of <code class="varname">COLUMN_A(i,j).TRAY()</code> must be equal to the dimensionality of
      <code class="varname">COLUMN_B(i,j).TRAY()</code><i class="emphasis">for all</i><code class="varname">i</code> and <code class="varname">j</code>.</p>
        </blockquote>
        <p>This must be true for the whole path of each term in the expression (unless the term is scalar). We can now define a <i class="emphasis">dimension
 tree</i> for each term, which describes completely the dimensionality of the term.</p>
        <p>The dimension trees for both terms in the example:</p><pre class="programlisting">UA(3:3,1:2).UB.P(1:4).V1 + UC.P(1,5:6).V2(1:4) = 3</pre>
        <p>are:</p>
        <ul>
            <li value="1">
                <p>(1,2)</p>
                <ul>
                    <li value="1">
                        <p>4</p>
                    </li>
                    <li value="2">
                        <p>4</p>
                    </li>
                </ul>
            </li>
        </ul>
        <p>If we were to write the expression as:</p><pre class="programlisting">UA(,).UB.P().V1 + UC.P(,).V2() = 3</pre>
        <p>with <code class="varname">UA(,)</code> and <code class="varname">UC.P(,)</code> both being 1x2 arrays; <code class="varname">UA(1,1).UB.P</code> having 3 elements;
    <code class="varname">UA(1,2).UB.P</code> having 4 elements; <code class="varname">UC.P(1,1).V2</code> having 4 elements and <code class="varname">UC.P(1,2).V2</code> having 3
 elements, then the dimension trees would be:</p>
        <ul>
            <li value="1">
                <p>(1,2) [<code class="varname">UA(,)</code>]</p>
                <ul>
                    <li value="1">
                        <p>3</p>
                    </li>
                    <li value="2">
                        <p>4</p>
                    </li>
                </ul>
            </li>
        </ul>
        <p>and:</p>
        <ul>
            <li value="1">
                <p>(1,2) [<code class="varname">UC.P(,)</code>]</p>
                <ul>
                    <li value="1">
                        <p>4</p>
                    </li>
                    <li value="2">
                        <p>3</p>
                    </li>
                </ul>
            </li>
        </ul>
        <p>As these two trees are not identical, the two terms will not be compatible and the expression will be illegal.</p>
        <p>The general rule for expressions involving arrays of units is therefore an extension of the rule for array Variables. If we have an
 expression of the form:</p><pre class="programlisting"><i class="emphasis">Expression E = Expression F;</i></pre>
        <p>it will be valid provided is conforms to one of the following four cases:</p>
        <div class="informaltable"><a name="AEN3063"></a>
            <table style="mc-table-style: url('../Resources/TableStyles/GeneralTable.css');margin-left: auto;margin-right: auto;" class="TableStyle-GeneralTable" cellspacing="0">
                <thead>
                    <tr class="TableStyle-GeneralTable-Head-Header1">
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1">Case</th>
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1"><i class="emphasis">E</i>
                        </th>
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1"><i class="emphasis">F</i>
                        </th>
                        <th align="center" class="TableStyle-GeneralTable-HeadD-Column1-Header1">Dimension tree of <i class="emphasis">E = F</i></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">1</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Scalar</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">2</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body2">Same as <i class="emphasis">E</i></td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">3</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Same as <i class="emphasis">F</i></td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">4</td>
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyA-Column1-Body2">Same as <i class="emphasis">E <i class="emphasis">and</i> F</i></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>In case 4, the dimension trees of <i class="emphasis">E</i> and <i class="emphasis">F</i> must be identical. Either expression may comprise binary
 operations of the form <i class="emphasis">x</i> âŠ• <i class="emphasis">y</i>, for which the following rules must also apply:</p>
        <div class="informaltable"><a name="AEN3104"></a>
            <table style="mc-table-style: url('../Resources/TableStyles/GeneralTable.css');margin-left: auto;margin-right: auto;" class="TableStyle-GeneralTable" cellspacing="0">
                <thead>
                    <tr class="TableStyle-GeneralTable-Head-Header1">
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1">Case</th>
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1"><i class="emphasis">x</i>
                        </th>
                        <th align="center" class="TableStyle-GeneralTable-HeadE-Column1-Header1"><i class="emphasis">y</i>
                        </th>
                        <th align="center" class="TableStyle-GeneralTable-HeadD-Column1-Header1">Dimension tree of <i class="emphasis">x <i class="emphasis">âŠ•</i> y</i></th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">1</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Scalar</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">2</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body2">Same as <i class="emphasis">x</i></td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">3</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Scalar</td>
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Same as <i class="emphasis">y</i></td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">4</td>
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">Dimension tree</td>
                        <td class="TableStyle-GeneralTable-BodyA-Column1-Body2">Same as <i class="emphasis">x <i class="emphasis">and</i> y</i></td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>Again, in case 4, the dimension trees of <i class="emphasis">x</i> and <i class="emphasis">y</i> must be identical.</p>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">© 2016 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>