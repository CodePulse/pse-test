<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="System Programmer Guide.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="System Programmer Guide|Developing New Foreign Processes|Implementation of Foreign Processes">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Writing Foreign Processes in C++</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <link href="../Resources/TableStyles/GeneralTable.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../System Programmer Guide.htm#Topics/x2039.html">Open topic with navigation</a>
        </p>
        <div>
            <div class="nocontent">
                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="5" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                </div>
            </div>
        </div>
        <h1><a name="AEN2039"></a>Writing Foreign Processes in C++</h1>
        <p>Although using C or FORTRAN as the implementation language should be sufficient for many applications, C++ may be more appropriate in more
 advanced cases, e.g. if you wish to connect multiple gPROMS Processes to one Foreign Process. In this case, the reasons outlined in the section on
      <a href="x1087.html">writing Foreign Objects</a> for choosing C++ apply here as well.</p>
        <p>The ideas outlined in this section are structurally similar to the section concerning Foreign Objects, <i class="emphasis">cf.</i> section on
      <a href="x1135.html">writing Foreign Objects in C++</a>.</p>
        <p>The basic idea for handling multiple gPROMS Processes connecting to one FPI is to define one class whose instances will be parameterised
 according to the gPROMS Process they represent or to define different classes and instantiate accordingly. The responsibilities then are divided
 into:</p>
        <ul>
            <li value="1">
                <p>the interface to gPROMS,</p>
            </li>
            <li value="2">
                <p>managing the multiple instances, comprising the task of creating, destroying and accessing them, and finally</p>
            </li>
            <li value="3">
                <p>the objects representing the different gPROMS processes.</p>
            </li>
        </ul>
        <p>Furthermore, the provided classes and interfaces are designed such that the user can use them as a library without having to bother with the
 low-level interface to gPROMS and the list of gPROMS processes.</p>
        <p>In the above list, the second group of responsibilities is dealt with by a single object, a so-called Factory. On request, this Factory will
 create and destroy Foreign Processes<a href="javascript:void(0);" class="MCTextPopup popup popupHead" style="font-size: 0.9em; vertical-align: super">1<span class="MCTextPopupBody MCTextPopupBody_Closed needs-pie popupBody"><span class="MCTextPopupArrow"></span>For brevity, the plural is used at this place. Remember, however, that gPROMS currently allows only one FPI, in contrast to multiple FO's.
 Nevertheless, it is possible to use multiple objects with different responsibilities within one FPI.</span></a>. Internally it keeps track of all the Foreign Processes. Actually, the Factory is designed to be the only interface through which
 Foreign Processes can be created and accessed; the key for retrieving them is the ForeignProcessHandle which was given to the Foreign Process upon
 creation.</p>
        <p>Since the Factory manages all the Foreign Processes, there should exist only one instance of the Factory class. This is ensured by a Singleton
 function, get_FPFactory(). This function (and only this function) provides access to the Factory, which is ensured by keeping constructors and
 destructors of the Factory class private.</p>
        <p>The interface functions are necessary because gPROMS expects the service procedures to be provided as functions. From the interface functions,
 then, member functions of the class implementation are called. For example, if you have implemented a class MyForeignProcess, a gPROMS call to gFOM()
 will actually be translated in a call to MyForeignObject::Evalmethod(). However, before this call actually takes place, the interface function first
 asks the Factory to retrieve the Foreign Process which is identified by the handle.</p>
        <p>The interface functions can be found in the file <tt class="filename">gFPInterface.cxx</tt> and need not be changed if it is not intended to change
 the underlying structure of the C++ interface.</p>
        <p>Two additional classes are provided, gFPClass and gFPFactory, both of which are purely abstract classes, which means you cannot instantiate
 them directly. Instead, their purpose is to provide the basic functionality (or interface) which has to be implemented in the Foreign Process. When
 defining and implementing a Foreign Process, the user should derive his own classes from these two classes and define the virtual functions of the
 abstract base classes. In this context, gFPClass is the base class for the Foreign Process, whereas gFPFactory is the base class for a user-provided
 Factory.</p>
        <p>When deriving from gFPClass, the only member functions which have to be provided by the user are the equivalents for the service procedures
 shown in the table below.</p>
        <div class="table"><a name="AEN2064"></a>
            <table style="mc-table-style: url('../Resources/TableStyles/GeneralTable.css');margin-left: auto;margin-right: auto;" class="TableStyle-GeneralTable" cellspacing="0">
                <caption>Service procedure and their C++ equivalent</caption>
                <tbody>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1"><i class="emphasis">Communication procedure</i>
                        </td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1"><i class="emphasis">C++ equivalent</i>
                        </td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">gFPPAUSE()</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body2">Pause()</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">gFPGET()</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Get()</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body2">gFPSEND()</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body2">Send()</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body1">
                        <td class="TableStyle-GeneralTable-BodyE-Column1-Body1">gFSENDM()</td>
                        <td class="TableStyle-GeneralTable-BodyD-Column1-Body1">Pause()</td>
                    </tr>
                    <tr class="TableStyle-GeneralTable-Body-Body2">
                        <td class="TableStyle-GeneralTable-BodyB-Column1-Body2">gFPLINEARISE()</td>
                        <td class="TableStyle-GeneralTable-BodyA-Column1-Body2">Linearise()</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <p>Note that the argument lists of the member functions in this table are identical to their corresponding routines in gFPInterface.h
      <i class="emphasis">except</i> that they are missing the first arguments of the latter identifying the calling gPROMS process and thus the specific
 instance since these routines operate on the specific object with which they are associated.</p>
        <p>Example implementations for these member functions can be found in <tt class="filename">fpi_demo_cpp.h</tt> resp.
      <tt class="filename">fpi_demo_cpp.cxx</tt>. gFPI() and gFPT() do not have to be defined because they call member functions which are already implemented
 in gFPFactory and which are responsible for creating and destroying Foreign Processes.</p>
        <p>When deriving a Factory from the provided gFPFactory, the only member function which has to be provided by the user is CreateObject() plus a
 global function which will provide access to the factory, FPfactory().</p>
        <p>If the proposed structure is adopted, none of the interface files has to be changed, only classes with the member functions as in the tank
 example have to be provided by the user.</p>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">© 2017 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>