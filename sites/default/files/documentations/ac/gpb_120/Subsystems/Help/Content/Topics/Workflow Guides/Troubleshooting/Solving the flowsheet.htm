<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="Help.xml" data-mc-path-to-help-system="../../../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>Solving the flowsheet</title>
        <link href="../../../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../../../Help.htm#Topics/Workflow Guides/Troubleshooting/Solving the flowsheet.htm">Open topic with navigation</a>
        </p>
        <div>
        </div>
        <h1>Solving the flowsheet</h1>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Flowsheet initialisation procedure</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>When the individual unit models have been converged, the next stage of the initialisation of the flowsheet is to converge recycles (see <a href="../Flowsheeting/Flowsheets with recycles.htm" class="MCXref xref" xrefformat="'{paratext}'">'Flowsheets with recycles'</a>) and imposing specification trade-offs (see <a href="../Trading off degrees of freedom/Trading off degrees of freedom.htm" class="MCXref xref" xrefformat="'{paratext}'">'Trading off degrees of freedom'</a>). </p>
                <p>This stage can be identified from the following output:</p><pre xml:space="preserve" class="executionOutput">Performing Initialisation Procedure with recycle(s) closed.</pre>
                <p>When the following message is displayed, the flowsheet model has been successfully  solved:</p><pre xml:space="preserve" class="executionOutput">Initialisation Procedure with recycle(s) closed performed successfully.</pre>
                <p>When this last message cannot be found in the execution output and instead an error message is shown, this indicates that a problem has occurred during this stage. To solve this type of problem it is important to be aware of the order in which recycle breakers are closed and specifications trade-offs are applied and the effect of initial guess values provided.</p>
            </div>
        </div>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Order of solving recycles and specification trade-offs</a></span>
            <div class="MCDropDownBody dropDownBody">
                <p>If no user-defined order of closing recycle breakers and doing unit specification trade-offs has been specified, the recycles will all be closed at the same time, together with the application of all the unit specification trade-offs. If a failure in converging the equations occurs at this point, the first approach to troubleshoot this error is, normally, to define an order in which recycle breakers need to be closed and unit specification trade-offs need to be applied. To define this custom order please refer to <a href="../Flowsheeting/Flowsheets with recycles.htm#Determin" class="MCXref xref" xrefformat="'{paratext}'">'Determining the order in which recycle streams are solved'</a> or, for specification trade-offs, <a href="../Trading off degrees of freedom/Trading off degrees of freedom.htm" class="MCXref xref" xrefformat="'{paratext}'">'Trading off degrees of freedom'</a>.</p>
                <p>When a user-defined order has been specified, each recycle breaker and adjust specification model is solved in turn. When a failure now occurs, during a certain step, it can be directly related to the closing of the associated recycle breaker or adjust specification model. To find which recycle breaker or specification trade-off cannot be solved, inspect the execution output for messages indicating which recycle breaker or specification trade-off is being solved:</p>
                <div class="programlisting"><pre xml:space="preserve" class="executionOutput">Performing Initialisation Procedure with recycle(s) closed.
Using the following Initialisation Procedures for the PROCESS.
MODEL "Troubleshooting_7_flowsheet_model_ip", Initialisation Procedure "Flowsheet" for unit "Flowsheet"
Initial set up from combined START sections.
MODEL "Recycle_breaker_gML", Initialisation Procedure "Interpolate_Close_Breaker_P_source_F_source_From_Zero" for unit "Flowsheet.rb1"
MODEL "Recycle_breaker_gML", Initialisation Procedure "Interpolate_Close_Breaker_P_source_F_source_From_Zero" for unit "Flowsheet.rb2"
Performing initialisation calculation at time: 0
Initialisation calculation completed.
  
Starting execution of Initialisation Procedure "Flowsheet" for unit "Flowsheet"
  
Starting execution of NEXT step 1 for unit "Flowsheet"[Flowsheet]<span style="color: #ff0000;">
Starting execution of ADVANCE unit "Flowsheet.rb1</span>"[Flowsheet]
Performing reinitialisation calculation at time: 0
Moving: NEXT step 1 unit "Flowsheet.rb1"  [Interpolate_Close_Breaker_P_source_F_source_From_Zero]
Moving: ADVANCE unit "Flowsheet.rb1"  [Flowsheet]
  
Ending execution of ADVANCE unit "Flowsheet.rb1"[Flowsheet]
Performing reinitialisation calculation at time: 1
* Execution of NEXT step 1 unit "Flowsheet.rb1" completed successfully.[Interpolate_Close_Breaker_P_source_F_source_From_Zero]
* Execution of ADVANCE unit "Flowsheet.rb1" completed successfully.[Flowsheet]
Starting execution of ADVANCE unit "Flowsheet.rb1"[Flowsheet]
Performing reinitialisation calculation at time: 1
* Execution of NEXT step 2 unit "Flowsheet.rb1" completed successfully.[Interpolate_Close_Breaker_P_source_F_source_From_Zero]
* Execution of ADVANCE unit "Flowsheet.rb1" completed successfully.[Flowsheet]
* Execution of NEXT step 1 unit "Flowsheet" completed successfully.[Flowsheet]
  
Starting execution of NEXT step 2 for unit "Flowsheet"[Flowsheet]<span style="color: #ff0000;">
Starting execution of ADVANCE unit "Flowsheet.rb2"[Flowsheet]</span>
Performing reinitialisation calculation at time: 1
Moving: NEXT step 1 unit "Flowsheet.rb2"  [Interpolate_Close_Breaker_P_source_F_source_From_Zero]
Moving: ADVANCE unit "Flowsheet.rb2"  [Flowsheet]
  
dbound-w-bounds are impeding progress - iteration stuck.</pre>
                    <p class="programlistingCaption">Messages indicating which recycle breaker is being solved at each step. In the first step recycle breaker "rb1" is closed, in the second set "rb2" is closed.</p>
                </div>
            </div>
        </div>
        <div class="MCDropDown MCDropDown_Open dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../../../Skins/Default/Stylesheets/Images/transparent.gif" height="13" width="16" alt="Closed" data-mc-alt2="Open" />Troubleshooting solving individual recycle breakers or specification trade-offs</a></span>
            <div class="MCDropDownBody dropDownBody">
                <h3>General approach</h3>
                <p>Typically, when closing recycle breaker units or applying specification trade-offs causes errors in converging the flowsheet, the reason is that the solution with the recycled stream or the specification trade-off does not exist at all or does not exist within the limits of the variables. Therefore, before following any of the troubleshooting steps outlined in this section, try to assess whether the flowsheet model with the recycle closed or specification trade-off applied will have a solution. This requires  understanding of the physical process being modelled. For specification trade-offs only, asses whether the variable that is being adjusted affects the variable that is to be set equal to a target value at all. </p>
                <p>The next step, both for problems with specification trade-offs and for recycle breakers, is to set the unit model to use a "Robust"-type initialisation procedure. Changing the initialisation procedure for the particular unit to a 'Robust'&#160;type procedure may, in itself, solve the problem when the solution does exist. </p>
                <p>However,  for more complex flowsheet models, it may be required to investigate what happens during the solution process for clues as to what the cause of the problem is. Make sure that the solution algorithm has been set up to produce partial results (see <a href="Solving the unit models.htm" class="MCXref xref" xrefformat="'{paratext}'">'Solving the unit models'</a>).</p>
                <h3>Determining whether variables that are traded-off influence each other</h3>
                <p>When an adjust model is used to trade-off two specifications that do not influence each other, the simulation will fail at the point this trade-off is applied. An error, similar to that shown below, will appear:</p>
                <div class="programlisting"><pre xml:space="preserve" class="executionOutput">Starting execution of NEXT step 1 for unit "Flowsheet"[Flowsheet]
Starting execution of ADVANCE unit "Flowsheet.adj1"[Flowsheet]
Performing reinitialisation calculation at time: 0
****************************************
Detected overspecified system: the following 1 equations involve only 0 variables:
Eqn[1]: Flowsheet.adj1.INIT.source_value - Flowsheet.adj1.INIT.target_value = 0
The variables involved are:

You need to ASSIGN 1 variable.
List of algebraic variables:</pre>
                    <p class="programlistingCaption">Error obtained when an adjust model is used to make a specification trade-off but the adjusted variable does not affect the variable to be set equal to a target value.</p>
                </div>
                <p>To solve this error, ensure that only specifications that influence each other are traded off.</p>
                <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span>
                    <p>In the following flow-driven flowsheet the model "adj1" has been used to adjust the "Mass flowrate"&#160;of source "s1" in order to satisfy a temperature target for source "s2". Clearly, the mass flowrate of source "s1" does not influence the temperature at source "s2". To solve this problem, make a specification trade-off that is valid. For example, the flowrate of source "s1" may influence the temperature at the sink "sink1".</p>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/flowsheet_adjust_with_no_causal_relation.png" />
                        </p>
                        <p class="FigureCaption">An attempt is made to adjust the flowrate of source "s2" by changing the flowrate of out of source "s1". Since these two things do not influence eachother in this flowrate the simulation will fail</p>
                    </div>
                </div>
                <h3>Changing the initialisation approach for recycle breaker and adjust models</h3>
                <h4>Recycle breakers</h4>
                <p>The first stage of troubleshooting, in the case of recycle breaker failures, is to choose a different initialisation procedure for the recycle breaker model. In the dialog for the recycle breaker unit model, set the 'Initialisation procedure'&#160;field to 'Robust'.</p>
                <div class="figure">
                    <p>
                        <img src="../../../Resources/Images/Workflow guides/Troubleshooting/recycle_breaker_initialisation_procedure.png" />
                    </p>
                    <p class="FigureCaption">Selecting 'Robust' initialisation procedure for the recycle breaker unit model</p>
                </div>
                <p>After selecting this method for closing the recycle breaker, run the simulation again to see whether the problem has been solved.</p>
                <h4>Adjust unit models</h4>
                <p>For adjust unit models which are used to trade off specifications, choosing a different initialisation procedure may also solve the problem. In the dialog for the adjust unit model, set the 'Initialisation procedure' to 'Automatic (Robust)'. </p>
                <div class="figure">
                    <p>
                        <img src="../../../Resources/Images/Workflow guides/Troubleshooting/recycle_breaker_initialisation_procedure.png" />
                    </p>
                    <p class="FigureCaption">Selecting 'Robust' initialisation procedure for the adjust unit model</p>
                </div>
                <p>After selecting this method for closing the adjust model, run the simulation again to see whether the problem has been solved. </p>
                <h3>Setting the solution algorithm to produce more output</h3>
                <p> To investigate the problem in more detail, the solution algorithm needs to be set to produce more intermediate results that can be used to identify what is going wrong during the solution process. To do this, click on the process associated with the flowsheet model, and select the "Solution parameters"&#160;tab. In the "Output generation" folder, set the reporting interval to something significantly smaller than 1, for example 0.01, to produce more output during the solution algorithm.</p>
                <div class="figure">
                    <p>
                        <img src="../../../Resources/Images/Workflow guides/Troubleshooting/flowsheet_initialisation_increasing_reporting_interval.png" />
                    </p>
                    <p class="FigureCaption">Setting the reporing interval to produce more output during the solution algorithm</p>
                </div>
                <p>Finally, set the model diagnostic information to produce information on variables that run into bounds during the solution process. To do this in the 'Numerical solvers/DASolver' folder set the 'Outputlevel' parameter to '2'.</p>
                <div class="figure">
                    <p>
                        <img src="../../../Resources/Images/Workflow guides/Troubleshooting/flowsheet_initialisation_increasing_outputlevel.png" />
                    </p>
                    <p class="FigureCaption">Setting the reporting interval to produce more output during the solution algorithm</p>
                </div>
                <h3>Inspecting intermediate results </h3>
                <p>After the flowsheet model has been configured to produce intermediate results, these results can be inspected in order to determine the cause of the problem. To do this, simulate the model and then inspect the trajectories for variables using the trajectory browser. These trajectories will be generated by the continuation method that is used when an initialisation procedure of the 'Robust' type is selected.</p>
                <p>For a recycle breaker, if the trajectory shows that the one of the stream variables changes at an increasing rate and goes to a value that is very different from the initial guess, it is likely that the solution does not exist for the flowsheet with a closed recycle. This may occur, for example, if there is a positive feedback loop involving the recycle. This means that for a particular stream property a higher value of the recycle breaker outlet causes an even higher value on the inlet.</p>
                <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span>
                    <p>A flowsheet might be wrongly configured so that all material is recycled and no product is produced. A simplified flowsheet that illustrates the problem is shown below. The splitter model "split1" has been wrongly configured such that all material goes into the recycle stream, and no material goes to the unit "sink1". Since the source has a fixed flowrate, this means that there is an infinite accumulation of material in the recycle loop and that no solution exists. This flowsheet will fail to converge when attempting to close the recycle breaker unit.</p>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_infinite_recycle.png" />
                        </p>
                        <p class="FigureCaption">Simple flowsheet with recycle stream</p>
                    </div>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_infinite_recycle_specification.png" />
                        </p>
                        <p class="FigureCaption">Splitter has been configured so that all material is recycled back</p>
                    </div>
                    <p>To troubleshoot this type of problem, set the initialisation procedure for the recycle breaker to 'Automatic (Robust)' and set the simulation up to produce partial results. Use a reporting interval of '0.01'. Run the simulation and inspect either the model report of the recycle breaker model or the inlet and outlet mass flowrates of the recycle breaker model.</p>
                    <p>Plotting the results for the recycle breaker outlet flowrate indicates that the flowrate increases asymptotically when the recycle breaker model is being solved. To resolve this issue change the splitter model configuration to direct part of its inlet flow to 'sink1'.</p>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_infinite_recycle_graph.png" />
                        </p>
                        <p class="FigureCaption">Splitter has been configured so that all material is recycled back</p>
                    </div>
                </div>
                <div class="example" data-mc-autonum="&lt;b&gt;Example&lt;/b&gt;"><span class="autonumber"><span><b>Example</b></span></span>
                    <p>A specification trade-off may be made that is not achievable. In the following flowsheet, the source "s1" produces a material stream of water at 300K, while source "s2" produces a material stream of water at 350K. These streams are mixed in "mix1" and then the mixed stream is fed to "sink1". A specification trade-off is made with an adjust model in which the mass flowrate of the stream out of source "s2" is changed to try to achieve a temperature of the stream flowing into the sink of 360K. Clearly this is not achievable as both of the inlet streams to the mixer are below 350K. </p>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_infinite_recycle_graph1.png" />
                        </p>
                        <p class="FigureCaption">Simple flowsheet with recycle stream</p>
                    </div>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_unachievable_spec_spec.png" />
                        </p>
                        <p class="FigureCaption">Splitter has been configured so that all material is recycled back</p>
                    </div>
                    <p>To troubleshoot this type of problem, set the initialisation procedure for the  adjust model "adj1" to 'Automatic (Robust)' and set the simulation up to produce partial results and use a reporting interval of '0.01'. Run the simulation and inspect the 'Source_value' and 'Adjusted'&#160;value for the adjust model.</p>
                    <p>Plotting the results for the adjusted variable shows that the flowrate out of the source "s2" increases asymptotically to try to achieve the temperature specification until the simulation fails. To resolve this issue, change the target specification for the sink temperature to an achievable value, for example 340K.</p>
                    <div class="figure">
                        <p>
                            <img src="../../../Resources/Images/Workflow guides/Troubleshooting/lowsheet_initialisation_unachievable_spec_graph.png" />
                        </p>
                        <p class="FigureCaption">Splitter has been configured so that all material is recycled back</p>
                    </div>
                </div>
            </div>
        </div>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">© 2017 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>