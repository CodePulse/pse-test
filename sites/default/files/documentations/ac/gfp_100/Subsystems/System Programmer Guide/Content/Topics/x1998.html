<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-gb" xml:lang="en-gb" data-mc-search-type="Stem" data-mc-help-system-file-name="System Programmer Guide.xml" data-mc-path-to-help-system="../../" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-medium="non-print" data-mc-toc-path="System Programming|Developing New Foreign Processes">
    <!-- saved from url=(0016)http://localhost -->
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><title>FPI implementation for real-time applications</title>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" data-mc-generated="True" />
        <link href="../Resources/Stylesheets/GeneralStyles.css" rel="stylesheet" />
        <script src="../../Resources/Scripts/custom.modernizr.js">
        </script>
        <script src="../../Resources/Scripts/jquery.min.js">
        </script>
        <script src="../../Resources/Scripts/require.min.js">
        </script>
        <script src="../../Resources/Scripts/require.config.js">
        </script>
        <script src="../../Resources/Scripts/foundation.min.js">
        </script>
        <script src="../../Resources/Scripts/plugins.min.js">
        </script>
        <script src="../../Resources/Scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <p class="MCWebHelpFramesetLink MCWebHelpFramesetLinkTop"><a href="../../System Programmer Guide.htm#Topics/x1998.html">Open topic with navigation</a>
        </p>
        <div>
            <div class="MCBreadcrumbsBox_0"><span class="MCBreadcrumbsPrefix">You are here: </span><a class="MCBreadcrumbsLink" href="c251.html">System Programming</a><span class="MCBreadcrumbsDivider"> &gt; </span><a class="MCBreadcrumbsLink" href="c1218.html">Developing New Foreign Processes</a><span class="MCBreadcrumbsDivider"> &gt; </span><span class="MCBreadcrumbs">FPI implementation for real-time applications</span>
            </div>
        </div>
        <h1><a name="FPIImplementationForReal-timeApplications"></a>FPI implementation for real-time applications</h1>
        <p>In many FPI applications (e.g. model-based control), it is essential for the gPROMS simulation to keep up with real time. There are several
 factors that may slow down the simulation. If this takes place to the extent that the simulation is slower than the real plant, performance issues
 clearly need to be addressed (see the section on FPI performance issues).</p>
        <p>On the other hand, a simulation will usually be faster than the real plant. In this case, the current simulation time must be continually
 compared with the real time, and the simulation must be made to wait for an appropriate period if necessary.</p>
        <p>The synchronisation can be done by a gPROMS Task that is being executed in parallel to the main simulation Schedule. This can be of the
 form:</p><pre class="programlisting" xml:space="preserve">TASK Synchronise
 PARAMETER
   SynchronisationInterval AS REAL
 VARIABLE
   StatVar AS LOGICAL
 SCHEDULE
   SEQUENCE
     StatVar := TRUE ;
     WHILE StatVar DO
     SEQUENCE
       CONTINUE FOR SynchronisationInterval
       PAUSE SIGNALID "SynchronisationSignal"
       STATUS StatVar
     END
   END
 END
END</pre>
        <p>The invocation of this Task from the main Schedule of the simulation specifies a synchronisation interval and a given termination condition. The
 main While loop in this Task consists of two steps: first, we allow the simulation to proceed for the SynchronisationInterval. We then issue a Pause
 request to the FPI, identifying this as a SynchronisationSignal. The gFPPAUSE procedure will have to intercept this, calculate the necessary waiting
 time, and act accordingly<a href="javascript:void(0);" class="MCTextPopup popup popupHead" style="font-size: 0.9em; vertical-align: super">1<span class="MCTextPopupBody MCTextPopupBody_Closed needs-pie popupBody"><span class="MCTextPopupArrow"></span>Here we are assuming the availability of two routines: Timer returning the elapsed real time since the start of the simulation, and Sleep
 that causes the calling program to wait for a specified period.</span></a>:</p><pre class="programlisting">SUBROUTINE gFPPAUSE (FPID, FPHANDLE, PRNAME,
 SIGNAL, TIME, STATUS)
 CHARACTER * 256 FPID, PRNAME, SIGNAL
 INTEGER FPHANDLE
 DOUBLE PRECISION TIME
 INTEGER STATUS
C
C.....Check if this is a synchronisation request
 IF (INDEX (SIGNAL, 'SynchronisationSignal') .GT. 0) THEN
C
C........Get real (elapsed) time since start of simulation
 CALL TIMER (RTIME)
C
C........Get time lag between simulation and real time
 TIMELG = TIME - RTIME
C
C........If necessary, make this procedure wait
 IF (TIMELG .GT. 0.0) THEN
 CALL SLEEP ( TIMELG )
 ELSE IF (TIMELG .LT. 0.0) THEN
 PRINT *,' Simulation falling behind real time...'
 STATUS = 0
 ENDIF
C
 ELSE
C
C........Other types of PAUSE request...
 . . . . . . . . . . . . . .
 ENDIF
C
 RETURN
 END</pre>
        <p>In some applications (e.g. operator training), we may actually wish to run the simulation at a constant factor (greater or smaller than 1) of
 real time. In such cases, we introduce a real quantity Factor and modify the line:</p><pre class="programlisting">TIMELG = TIME - RTIME</pre>
        <p>in the gFPPAUSE procedure to:</p><pre class="programlisting">TIMELG = TIME/FACTOR - RTIME</pre>
        <p>For instance, if Factor = 2.0, the above will make the simulation run twice as fast as real time - assuming, of course, that this is achievable
 with the given model and hardware.</p>
        <div>
            <p class="Footer">&#160;</p>
            <p class="Footer">&#160;</p>
            <hr width="100%" size="0" align="center" />
            <p class="Footer">Commercial in confidence</p>
            <p class="Footer">Â© 2017 Process Systems Enterprise Limited</p>
        </div>
    </body>
</html>